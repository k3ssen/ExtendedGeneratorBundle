# App configuration

parameters:
    env(MAILER_USER): '' #fallback MAILER_USER if the env var is not set.
    mailer_user: '%env(resolve:MAILER_USER)%'

# TODO: Move to fos_user.yaml
# see https://symfony.com/doc/master/bundles/FOSUserBundle/index.html#step-4-configure-your-application-s-security-yml
fos_user:
    db_driver: orm # other valid values are 'mongodb' and 'couchdb'
    firewall_name: main
    user_class: App\Entity\User
    from_email:
        address: "%mailer_user%"
        sender_name: "%mailer_user%"
    service:
        mailer: fos_user.mailer.twig_swift # fixes templating service requirement: https://github.com/FriendsOfSymfony/FOSUserBundle/issues/2692#issuecomment-363431743

# TODO: Move to twig.yaml
twig:
    form_themes: ['bootstrap_4_horizontal_layout.html.twig']

# TODO: Move to security.yaml
# see https://symfony.com/doc/master/bundles/FOSUserBundle/index.html#step-4-configure-your-application-s-security-yml
security:
    encoders:
        FOS\UserBundle\Model\UserInterface: bcrypt

    role_hierarchy:
        ROLE_ADMIN:       ROLE_USER
        ROLE_SUPER_ADMIN: ROLE_ADMIN

    providers:
        fos_userbundle:
            id: fos_user.user_provider.username

    firewalls:
        main:
            pattern: ^/
            form_login:
                provider: fos_userbundle
                csrf_token_generator: security.csrf.token_manager
            logout:       true
            anonymous:    true

    access_control:
        - { path: ^/login$, role: IS_AUTHENTICATED_ANONYMOUSLY }
        - { path: ^/register, role: IS_AUTHENTICATED_ANONYMOUSLY }
        - { path: ^/resetting, role: IS_AUTHENTICATED_ANONYMOUSLY }
        - { path: ^/admin/, role: ROLE_ADMIN }
        - { path: ^/, role: ROLE_USER }

# TODO: Move to services.yaml
services:
    Sg\DatatablesBundle\Response\DatatableResponse: '@sg_datatables.response'

    App\Router\Router:
        decorates: 'router'
        arguments: ['@App\Router\Router.inner']